지금까지 IP 헤더의 기본 헤더만 알아봤고, 여기서는 옵션 관련 부분에 대해서 알아볼 것이다.

![](../../images/Pasted%20image%2020251125000809.png)

IP 옵션(option)은 **type 8비트 + length 8비트** 구조로 이루어진다. 첫 번째 바이트는 옵션의 종류를 나타내는 **type 필드**, 두 번째 바이트는 해당 옵션 전체의 길이를 나타내는 **length 필드**로 구성된다.

이 두 필드 뒤에 옵션에 필요한 실제 데이터가 이어 붙는 형태로 옵션들이 나열된다.

![](../../images/Pasted%20image%2020251125000942.png)

---
## No operation option
자 가장 먼저 살펴본건 single byte 옵션인 No operation 옵션이다.

![](../../images/Pasted%20image%2020251125001149.png)

쉽게 말하면, **옵션 사이에 생기는 빈 공간을 채워 넣는 역할**을 하는 것이 바로 padding이다. 이 패딩은 옵션 목록의 **시작 부분에 들어갈 수도 있고**, 여러 옵션이 나열되는 과정에서 **옵션과 옵션 사이의 남는 공간을 채우는 용도로도 사용될 수 있다.**

즉, 옵션 영역을 4바이트 단위로 맞추기 위해 필요한 만큼의 채움(byte)을 넣는 것이며, 이를 통해 전체 IP 헤더의 정렬(alignment)을 유지한다.

---
## End of option option

싱글 바이트 옵션 중 두 번째 타입은 **옵션이 더 이상 없다는 것을 알리는 ‘End of Option List’ 옵션**이다. 이 바이트가 등장하면, 그 뒤부터는 더 이상 옵션이 없으며 **곧바로 데이터 영역이 이어진다**는 뜻이 된다. 즉, 수신 측은 이 옵션을 통해 “옵션 구간이 종료되었고, 다음부터는 payload를 읽으면 된다”는 것을 판단할 수 있다.

![](../../images/Pasted%20image%2020251125001450.png)

---
## Record Route Option

Record-route 옵션은 패킷이 네트워크를 통과하면서 **거쳐 간 라우터의 IP 주소를 기록하는 기능**을 한다. 하나의 네트워크에서 다른 네트워크로 이동하려면 반드시 라우터를 지나게 되는데, 이 옵션을 사용하면 패킷이 지나간 라우터들의 주소를 헤더 옵션 영역에 순서대로 남길 수 있다.

![](../../images/Pasted%20image%2020251125001824.png)

라우터는 들어오는 인터페이스와 나가는 인터페이스 주소가 서로 다를 수 있다. 이때 record-route 옵션에 기록되는 것은 **나가는 쪽(outgoing interface)의 IP 주소**이다. 이는 패킷이 다음 네트워크로 넘어갈 때 실제로 사용되는 주소이기 때문에, 경로 추적 목적에 더 적합하다.

옵션의 전체 공간은 IP 헤더 확장 영역에서 **최대 40바이트**까지 사용할 수 있다. Record-route 옵션 자체는 타입과 길이 등을 포함하는 **4바이트의 옵션 헤더**가 필요하므로, 실제 주소를 기록할 수 있는 공간은 40 - 4 = **36바이트**가 된다.

IPv4 주소 하나는 4바이트이므로, `36바이트 ÷ 4바이트 = 최대 9개 주소 기록 가능`
따라서 record-route 옵션을 사용하면 패킷이 지나간 **최대 9개의 라우터 주소**를 기록할 수 있다.

![](../../images/Pasted%20image%2020251125002250.png)

Record-route 옵션에는 **포인터(pointer) 필드**가 존재하는데, 이 값은 _다음 라우터 주소가 기록될 위치_를 가리킨다. 예를 들어 포인터 값이 **4**라면, 옵션의 시작부터 4바이트 지점이 첫 번째 라우터 주소를 기록할 자리라는 뜻이다. 이후 라우터는 패킷을 전달하기 전에 포인터가 가리키는 위치에 자신의 **outgoing 인터페이스 IP 주소**를 기록하고, 포인터 값을 4바이트 증가시켜 다음 기록 위치를 지정한다.

만약 포인터 값이 옵션 전체 길이를 초과하게 되면, 더 이상 기록할 공간이 없다는 의미이므로 **라우터들은 추가 주소를 기록하지 않고 그대로 패킷을 전달한다.**

즉, 포인터는 “다음에 기록할 주소 칸”을 지정하며, 포인터가 옵션 길이보다 커지면 record-route 옵션의 기록 과정은 종료된다. 만약에 이 포인터가 전체 길이보다 크면 기록은 끝난다.

---
## Strict Source Route Option
Strict Source Route 옵션도 패킷이 지나가는 **라우터의 주소를 기록한다는 점에서는 Record-route 옵션과 비슷**하다. 그러나 근본적인 목적은 다르다. 이 옵션은 단순히 경로를 _기록_하는 것이 아니라, **패킷이 반드시 지나가야 할 경로(다음 라우터)를 송신자가 직접 지정하는 기능**을 제공한다.

일반적으로 라우터는 자신의 라우팅 테이블을 참고해 “다음 홉(next hop)”을 자동으로 결정한다. 하지만 Strict Source Route 옵션을 사용하면, **IP 헤더 안의 옵션 필드에 미리 지정된 경로를 그대로 따라야 하며**, 라우터는 자신의 라우팅 테이블을 무시하고 옵션에 적힌 다음 주소로 패킷을 전달해야 한다.


![](../../images/Pasted%20image%2020251125002459.png)

이 옵션 역시 record-route 옵션과 동일한 구조를 가지기 때문에 **지정 가능한 주소는 최대 9개**까지 넣을 수 있다.

![](../../images/Pasted%20image%2020251125002225.png)

Record-route 옵션과 Strict Source Route 옵션은 모두 라우터 주소가 옵션 영역에 기록된다는 공통점이 있지만, 핵심적인 동작 방식에서 큰 차이가 있다.

먼저 **Record-route 옵션**은 옵션 공간이 _비워진 상태로 출발_한다. 패킷이 라우터를 지날 때마다, 각 라우터는 자신의 **outgoing 인터페이스 주소**를 옵션 공간의 빈 슬롯에 순서대로 채워 넣는다. 즉, 경로를 “지나오면서 기록하는 방식”이다.

반면에 **Strict Source Route 옵션**은 출발할 때부터 **패킷이 지나가야 할 라우터 주소들이 미리 모두 채워진 상태**로 전달된다. 송신자가 패킷의 이동 경로를 강제로 지정해서 보내는 방식이다.

여기서 중요한 차이가 하나 더 있다. Strict Source Route 옵션에는 **포인터(pointer)** 가 존재하는데, 이 포인터는 “다음으로 향해야 할 라우터 주소가 들어 있는 옵션 내 위치(offset)”를 가리킨다. 라우터는 자신의 라우팅 테이블을 보지 않고, 이 포인터가 가리키는 주소를 그대로 다음 hop으로 사용한다.

패킷이 해당 라우터를 성공적으로 통과하면 다음 일이 일어난다:

1. **포인터가 가리키던 위치에 있던 ‘원래 지정된 경로 주소’를 라우터의 outgoing IP 주소로 덮어쓴다.**  즉, 옵션 공간의 _그 자리_에 자신이 지나갔다는 기록을 남긴다.
    
2. 포인터는 **4바이트 증가하여**, 다음 경로 주소가 있는 위치를 가리키게 된다.

이 구조 덕분에 Strict Source Route는 **포인터를 이용해 다음 이동 경로를 강제하고**, **지나간 위치에는 자신의 주소를 덮어써 기록하며**, 패킷이 정확한 순서로 경로를 따라왔는지 확인할 수 있다.

---
## Loose Source Route Option

Loose Source Route 옵션은 경유지와 관련된 마지막 옵션으로, 패킷이 반드시 지나야 할 **특정 경유지의 목록을 지정한다는 점에서** Strict Source Route와 비슷하다. 그러나 두 옵션의 가장 큰 차이는 **경로 강제의 강도**다.

Strict Source Route가 “지정된 라우터들을 **정확히 순서대로** 지나가야 한다”고 강하게 강제하는 방식이라면, **Loose Source Route는 경유지까지만 도달하면 되고, 그 경유지 사이를 어떤 라우터를 통해 갈지는 상관하지 않는다.** 즉, 경유지 간의 세부 경로는 네트워크 상황에 따라 자유롭게 라우팅된다.

![](../../images/Pasted%20image%2020251125003232.png)

이 옵션의 동작은 다음처럼 이해할 수 있다.

패킷이 목적지까지 도착하는 과정에서 **지정된 중간 경유지(router)** 는 반드시 방문해야 한다. 그러나 경유지와 경유지 사이의 **정확한 next-hop** 은 라우터의 라우팅 테이블에 맡긴다. 결국 패킷이 목적지에 도착하고 나면, 옵션 영역에 남아 있는 기록을 통해 **중간에 어떤 경유지를 거쳤는지** 확인할 수 있다.

---
## Time - stamp option

쉽게 말하면 **라우터를 지나온 시간을 IP 옵션 필드에 기록하는 기능**이다.

![](../../images/Pasted%20image%2020251126164034.png)

위 그림을 보면 오른쪽 위에 **flags** 값이 있는데, 이 값에 따라서 시간 기록 방식이 달라진다.

![](../../images/Pasted%20image%2020251126164048.png)

- **flag = 0**  
    단순히 “지나온 라우터에서의 시간”만 기록한다.
    
- **flag = 1**  
    “지나온 라우터의 주소 + 해당 라우터에서의 시간”을 함께 기록한다.
    
- **flag = 3**  
    Strict Source Route 옵션처럼 **미리 라우터 주소들을 적어 두고**, 실제로 그 라우터를 통과했을 때 그 위치에 시간을 채워 넣는 방식이다.  
    (중간 값인 2는 존재하지 않는다.)

![](../../images/Pasted%20image%2020251126164346.png)

예시를 보면 flag가 1일 때이므로, **지나온 라우터의 주소와 시간을 함께 적는 모드**이다.  
이 경우 라우터를 지날 때 기록되는 라우터 주소는 **해당 라우터에서 패킷이 나가는(outgoing) 인터페이스 주소**이고, 바로 그 주소 뒤에 해당 시점의 시간을 기록하게 된다.

---
