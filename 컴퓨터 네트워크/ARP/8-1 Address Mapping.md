패킷이 호스트나 라우터로 전달되기 위해서는 두 가지 주소가 필요하다. 하나는 논리적 주소인 **IP 주소**, 다른 하나는 물리적 주소인 **MAC 주소**이다. 네트워크에서는 IP 주소를 기반으로 목적지의 MAC 주소를 찾아야 하므로, 이 두 주소는 서로 **매핑 관계**를 가져야 한다.


조금 더 자세히 살펴보면, 호스트나 라우터는 다른 호스트나 라우터에게 전달하기 위한 **IP 데이터그램(IP datagram)** 을 가지고 있다. 또한 상대방의 논리적 주소인 **IP 주소** 역시 알고 있다고 가정하자.

그러나 IP 데이터그램은 네트워크 계층에서 데이터 링크 계층으로 내려가면서 **프레임(frame)** 으로 캡슐화된다. 이때 데이터는 프레임 형태로 전송되므로, 결국 상대방의 **물리적 주소(MAC 주소)** 를 반드시 알아야 전송이 가능하다.

---
## Position of ARP in TCP/IP protocol suite

ARP는 **네트워크 계층과 데이터 링크 계층 사이에서 동작하는 프로토콜**로, 일반적으로 네트워크 계층에 속한 것으로 이해할 수 있다. ARP의 역할은 네트워크 계층에서 사용하는 **IP 주소**를 기반으로, 실제 프레임 전송에 필요한 **MAC 주소**를 알아내는 것이다.

![](../../images/Pasted%20image%2020251205111738.png)

---
## ARP operation

어떻게 작동하는지 전체 흐름을 보자면 아까도 말햇듯 IP datagram을 보낼 떄 datalink 계층으로 내려서 frame으로 만든다. 이때 MAC 주소를 붙이게 되는데, 여기서 내 MAC 주소와 상대방 MAC 주소를 넣게 된다. 근데 만약에 ARP 테이블을 보니까 상대방 IP 주소는 아는데, 상대방의 MAC 주소는 없다! 이런 경우에 MAC 주소 알려줘~ 하고 보내는게 ARP request이다. 

![](../../images/Pasted%20image%2020251205111951.png)

ARP request를 보내는데, 보낼 때조차도 상대방의 MAC 주소는 모르기 때문에 broadcast로 보내게 된다. 즉 같은 네트워크 안의 모두에게 보낸다. 그럼 같은 네트워크의 모두가 받을 것이다. 보낼 때는 보낸 사람의 IP 주소 MAC 주소 그리고 상대방의 IP 주소가 포함되어 잇다. 그래서 이걸 받은 모두는 ARP 가 왓네? 를 인지하고 해체해서 목적지가 내 IP랑 동일한지 확인한다. 내 IP가 아니라면 그냥 버리면 되고, 맞다면 내 MAC 주소를 포함해서 다시 보내주면 된다.

![](../../images/Pasted%20image%2020251205112551.png)

다시 보낼 때는 unicast즉 일대일로 보내게 된다. ARP reuqest에는 보낸 사람의 IP주소와 MAC주소가 포함된 체로 오기 때문에, 그냥 그곳으로 보내면 되기 때문이다.


