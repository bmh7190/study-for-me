패킷이 호스트나 라우터로 전달되기 위해서는 두 가지 주소가 필요하다. 하나는 논리적 주소인 **IP 주소**, 다른 하나는 물리적 주소인 **MAC 주소**이다. 네트워크에서는 IP 주소를 기반으로 목적지의 MAC 주소를 찾아야 하므로, 이 두 주소는 서로 **매핑 관계**를 가져야 한다.

조금 더 자세히 살펴보면, 호스트나 라우터는 다른 호스트나 라우터에게 전달하기 위한 **IP 데이터그램(IP datagram)** 을 가지고 있다. 또한 상대방의 논리적 주소인 **IP 주소** 역시 알고 있다고 가정하자.

그러나 IP 데이터그램은 네트워크 계층에서 데이터 링크 계층으로 내려가면서 **프레임(frame)** 으로 캡슐화된다. 이때 데이터는 프레임 형태로 전송되므로, 결국 상대방의 **물리적 주소(MAC 주소)** 를 반드시 알아야 전송이 가능하다.

---
## Position of ARP in TCP/IP protocol suite

ARP는 **네트워크 계층과 데이터 링크 계층 사이에서 동작하는 프로토콜**로, 일반적으로 네트워크 계층에 속한 것으로 이해할 수 있다. ARP의 역할은 네트워크 계층에서 사용하는 **IP 주소**를 기반으로, 실제 프레임 전송에 필요한 **MAC 주소**를 알아내는 것이다.

![](../../images/Pasted%20image%2020251205111738.png)

---
## ARP operation

전체 동작 흐름을 살펴보면 다음과 같다. 앞서 말했듯이, IP 데이터그램을 전송할 때는 네트워크 계층에서 데이터 링크 계층으로 내려가 **프레임(frame)** 으로 캡슐화된다. 이때 프레임에는 **송신자의 MAC 주소**와 **수신자의 MAC 주소**가 반드시 포함되어야 한다.

하지만 ARP 테이블을 확인해보니, 상대방의 **IP 주소는 알고 있는데 MAC 주소는 모르는 상황**일 수 있다. 이런 경우 “상대방 MAC 주소 알려줘!”라고 요청하는 것이 바로 **ARP Request**이다.

![](../../images/Pasted%20image%2020251205111951.png)

ARP Request를 보낼 때는 아직 상대방의 MAC 주소를 모르기 때문에, 이를 **브로드캐스트(broadcast)** 로 전송한다. 즉, 같은 네트워크(같은 LAN)의 모든 장비에게 패킷을 뿌리는 것이다.

ARP Request에는 다음 정보가 담겨 있다.

- 보낸 사람(Sender)의 IP 주소
    
- 보낸 사람(Sender)의 MAC 주소
    
- 알고 싶은 대상(Target)의 IP 주소


LAN 안의 모든 장비는 이 ARP Request를 수신하고, “요청된 IP가 **내 IP와 일치하는가?**”를 확인한다 **일치하지 않으면** 패킷을 버린고, **일치하면**, 자신의 MAC 주소를 담아 **ARP Reply**를 만들어 응답한다.

![](../../images/Pasted%20image%2020251205112551.png)

ARP Reply를 보낼 때는 브로드캐스트가 아니라 **유니캐스트(unicast)** 방식으로 전송된다. 그 이유는 간단하다. ARP Request 안에 이미 **요청자의 IP와 MAC 주소**가 포함되어 있기 때문에, 그 정보로 정확하게 요청자에게만 응답하면 되기 때문이다.

---
## ARP packet

ARP 메시지의 구조는 다음과 같다.

![](../../images/Pasted%20image%2020251205130036.png)

- **Hardware Type**: 사용되는 물리 주소(하드웨어 주소)의 종류를 나타낸다. MAC 주소도 네트워크 기술에 따라 형태가 달라질 수 있는데, 우리가 일반적으로 사용하는 **이더넷(Ethernet)** 환경에서는 항상 값이 **1**로 설정된다.
    
- **Protocol Type**: MAC 주소와 매핑하려는 **상위 계층의 프로토콜이 무엇인지**를 나타낸다. IPv4 주소를 사용한다면 이 값은 **0x0800**으로 설정된다.
    
- **Hardware Address Length**: 하드웨어 주소(MAC 주소)의 길이를 나타낸다. MAC 주소는 6바이트이므로 이 값은 **6**이 된다.
    
- **Protocol Address Length**: 프로토콜 주소(IP 주소 등)의 길이를 나타낸다. IPv4 주소의 길이는 4바이트이므로 이 값은 **4**로 설정된다.
    
- **Operation**: ARP 패킷이 어떤 동작을 의미하는지를 나타낸다. 대표적으로 다음과 같은 값이 있다.
    
    - **1**: ARP Request
        
    - **2**: ARP Reply
        
    - **3**: RARP Request
        
    - **4**: RARP Reply

---
## Encapsulation of ARP packet

이 그림은 **이더넷 프레임(Ethernet frame)** 의 구조를 나타낸 것이다. 

![](../../images/Pasted%20image%2020251205130813.png)

프레임에는 가장 앞부분에 **Destination MAC Address**, **Source MAC Address**가 들어가며, 이 두 주소는 모두 **물리적 주소(MAC 주소)** 로 표현된다. ARP Request 보낼 때 Source address는 자신의 MAC 주소로 채우면 되지만, Destination address는 모르기 때문에 전부 1로 채운 주소로 채운다.

그 다음 위치에 있는 **Type 필드**는 이 프레임 안에 담긴 데이터가 무엇인지를 나타낸다. 예를 들어 Type 값이 다음과 같다면:

- **0x0800 → IPv4**
    
- **0x0806 → ARP**
    
- **0x8847 → MPLS**
    
이더넷은 이 **Type 값을 보고** 프레임의 Data 영역을 어떻게 해석할지를 결정한다. 즉, 이 값을 기반으로 뒤에 이어지는 데이터가 **IP 데이터그램인지**, **ARP 메시지인지**, **MPLS 패킷인지** 등을 구분하는 것이다.

##### MAC 주소와 각 필드의 크기

- **MAC 주소(MAC Address)** 는 **6바이트(48비트)** 로 구성되어 있다. 따라서 Destination MAC(6B) + Source MAC(6B) = 총 12바이트이다.
    
- **Type 필드** 는 **2바이트**(16비트)이다.
    
- **Data 필드** 는 **최소 46바이트 ~ 최대 1500바이트** 로 구성된다.  

프레임 내부에서 Data 영역이 최소 46바이트가 되어야 한다는 규칙은 예전에 다루었던 **IP 헤더의 Total Length 문제**와 연결된다. 만약 상위 계층에서 내려오는 데이터가 너무 짧아 Data 영역이 46바이트에 미치지 못하면, 이더넷은 **padding** 을 넣어 46바이트를 채운다.

---
## Four cases using ARP

ARP가 필요한 상황은 대표적으로 다음 네 가지 경우로 나눌 수 있다. 기본적으로 **같은 네트워크(LAN)** 안에서만 ARP가 동작한다는 점을 전제로 한다.

![](../../images/Pasted%20image%2020251205131539.png)


1. **같은 네트워크에 있는 Host ↔ Host 간 통신**  
    두 호스트가 동일한 LAN에 있고, 서로에게 직접 프레임을 보내기 위해 **상대방의 MAC 주소를 알아야 하는 경우** ARP가 필요하다.
    
2. **Host → Router (다른 네트워크로 나가기 위한 게이트웨이 주소 탐색)**  
    호스트가 다른 네트워크로 패킷을 보내려고 할 때, 먼저 **기본 게이트웨이(라우터)의 MAC 주소**를 알아야 한다. 이때 게이트웨이의 MAC 주소를 찾기 위해 ARP가 수행된다.
    
3. **Router ↔ Router 간 통신 (같은 세그먼트에 존재하는 경우)**  
    두 라우터가 같은 네트워크 세그먼트에 있을 때, 서로 프레임을 주고받기 위해 **상대 라우터의 MAC 주소**가 필요하다. 이 역시 ARP를 통해 MAC 주소를 획득한다.
    
4. **Router → Host (같은 네트워크에 있는 목적지 호스트 탐색)**  
    라우터가 패킷을 포워딩하다가, 목적지가 자기와 같은 네트워크에 있는 호스트라면, 그 호스트의 **MAC 주소를 알아야** 프레임을 전송할 수 있다. 이때도 ARP가 사용된다.

---
## Example

예를 들어, **130.23.43.20에서 130.23.43.25로 패킷을 보내려는 상황**을 생각해보자. 라우팅 테이블을 확인해보면 두 주소가 **같은 네트워크에 속한다**는 것을 알 수 있으므로, 패킷은 라우터를 거치지 않고 직접 전송될 수 있다.

![](../../images/Pasted%20image%2020251205132139.png)

하지만 실제로 프레임을 만들어 전송하려면 **상대방의 MAC 주소가 필요**하다. ARP 테이블을 확인했는데, 상대방(130.23.43.25)의 MAC 주소가 없다면, 호스트는 **ARP Request**를 전송하게 된다.

ARP Request는 같은 네트워크 내 모든 장비에게 보내기 위해 **브로드캐스트 MAC 주소(FF:FF:FF:FF:FF:FF)** 를 사용하여 전송된다.  
각 장비는 이 ARP Request를 받아 다음과 같은 과정을 거친다:

1. **프레임을 수신**하고
    
2. **이더넷 헤더(Destination MAC)** 가 브로드캐스트인지 확인한 뒤
    
3. 프레임 내부의 **ARP 메시지**를 해석하고
    
4. 요청된 **Target IP(130.23.43.25)** 가 자신의 IP와 동일한지 검사한다.

만약 IP가 일치한다면, 해당 장비는 자신의 **MAC 주소를 포함한 ARP Reply**를 요청자에게 보낸다.

이때 구조를 보면 다음과 같다.

![](../../images/Pasted%20image%2020251205132849.png)

##### **Frame 헤더**

- **Destination MAC:** FF:FF:FF:FF:FF:FF (브로드캐스트)
    
- **Source MAC:** 130.23.43.20의 MAC 주소
    
- **Type:** 0x0806 (ARP)
    

##### **ARP 패킷 내부**

- **Sender MAC:** 130.23.43.20의 MAC
    
- **Sender IP:** 130.23.43.20
    
- **Target IP:** 130.23.43.25
    
- **Target MAC:** 아직 모르기 때문에 **00:00:00:00:00:00 또는 FF:FF:FF:FF:FF:FF** 로 표현됨
    

즉, **프레임 헤더에서도 MAC 주소가 존재하고, ARP 메시지 내부에도 MAC 주소 정보가 각각 들어간다.** 프레임 헤더는 “이 프레임을 누구에게 전달할지”를 위해 필요하고, ARP 메시지 안의 MAC 주소는 “어떤 장비의 정보를 질의하거나 처리하기 위해” 사용된다.