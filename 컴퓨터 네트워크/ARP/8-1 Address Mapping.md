패킷이 호스트나 라우터로 전달되기 위해서는 두 가지 주소가 필요하다. 하나는 논리적 주소인 **IP 주소**, 다른 하나는 물리적 주소인 **MAC 주소**이다. 네트워크에서는 IP 주소를 기반으로 목적지의 MAC 주소를 찾아야 하므로, 이 두 주소는 서로 **매핑 관계**를 가져야 한다.


조금 더 자세히 살펴보면, 호스트나 라우터는 다른 호스트나 라우터에게 전달하기 위한 **IP 데이터그램(IP datagram)** 을 가지고 있다. 또한 상대방의 논리적 주소인 **IP 주소** 역시 알고 있다고 가정하자.

그러나 IP 데이터그램은 네트워크 계층에서 데이터 링크 계층으로 내려가면서 **프레임(frame)** 으로 캡슐화된다. 이때 데이터는 프레임 형태로 전송되므로, 결국 상대방의 **물리적 주소(MAC 주소)** 를 반드시 알아야 전송이 가능하다.

---
## Position of ARP in TCP/IP protocol suite

ARP는 **네트워크 계층과 데이터 링크 계층 사이에서 동작하는 프로토콜**로, 일반적으로 네트워크 계층에 속한 것으로 이해할 수 있다. ARP의 역할은 네트워크 계층에서 사용하는 **IP 주소**를 기반으로, 실제 프레임 전송에 필요한 **MAC 주소**를 알아내는 것이다.

![](../../images/Pasted%20image%2020251205111738.png)

---
## ARP operation

전체 동작 흐름을 살펴보면 다음과 같다. 앞서 말했듯이, IP 데이터그램을 전송할 때는 네트워크 계층에서 데이터 링크 계층으로 내려가 **프레임(frame)** 으로 캡슐화된다. 이때 프레임에는 **송신자의 MAC 주소**와 **수신자의 MAC 주소**가 반드시 포함되어야 한다.

하지만 ARP 테이블을 확인해보니, 상대방의 **IP 주소는 알고 있는데 MAC 주소는 모르는 상황**일 수 있다. 이런 경우 “상대방 MAC 주소 알려줘!”라고 요청하는 것이 바로 **ARP Request**이다.

![](../../images/Pasted%20image%2020251205111951.png)

ARP Request를 보낼 때는 아직 상대방의 MAC 주소를 모르기 때문에, 이를 **브로드캐스트(broadcast)** 로 전송한다. 즉, 같은 네트워크(같은 LAN)의 모든 장비에게 패킷을 뿌리는 것이다.

ARP Request에는 다음 정보가 담겨 있다.

- 보낸 사람(Sender)의 IP 주소
    
- 보낸 사람(Sender)의 MAC 주소
    
- 알고 싶은 대상(Target)의 IP 주소


LAN 안의 모든 장비는 이 ARP Request를 수신하고, “요청된 IP가 **내 IP와 일치하는가?**”를 확인한다 **일치하지 않으면** 패킷을 버린고, **일치하면**, 자신의 MAC 주소를 담아 **ARP Reply**를 만들어 응답한다.

![](../../images/Pasted%20image%2020251205112551.png)

ARP Reply를 보낼 때는 브로드캐스트가 아니라 **유니캐스트(unicast)** 방식으로 전송된다. 그 이유는 간단하다. ARP Request 안에 이미 **요청자의 IP와 MAC 주소**가 포함되어 있기 때문에, 그 정보로 정확하게 요청자에게만 응답하면 되기 때문이다.

---
## ARP packet

ARP 메시지의 구조는 다음과 같다.

![](../../images/Pasted%20image%2020251205130036.png)

- **Hardware Type**: 사용되는 물리 주소(하드웨어 주소)의 종류를 나타낸다. MAC 주소도 네트워크 기술에 따라 형태가 달라질 수 있는데, 우리가 일반적으로 사용하는 **이더넷(Ethernet)** 환경에서는 항상 값이 **1**로 설정된다.
    
- **Protocol Type**: MAC 주소와 매핑하려는 **상위 계층의 프로토콜이 무엇인지**를 나타낸다. IPv4 주소를 사용한다면 이 값은 **0x0800**으로 설정된다.
    
- **Hardware Address Length**: 하드웨어 주소(MAC 주소)의 길이를 나타낸다. MAC 주소는 6바이트이므로 이 값은 **6**이 된다.
    
- **Protocol Address Length**: 프로토콜 주소(IP 주소 등)의 길이를 나타낸다. IPv4 주소의 길이는 4바이트이므로 이 값은 **4**로 설정된다.
    
- **Operation**: ARP 패킷이 어떤 동작을 의미하는지를 나타낸다. 대표적으로 다음과 같은 값이 있다.
    
    - **1**: ARP Request
        
    - **2**: ARP Reply
        
    - **3**: RARP Request
        
    - **4**: RARP Reply