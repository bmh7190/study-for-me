
지금까지 다뤘던 외부 단편화(external fragmentation)를 줄이기 위한 방법인 **페이징(Paging)** 은, 메인 메모리에 프로세스가 원하는 데이터가 이미 존재한다는 가정을 바탕으로 설명되었다. 이제부터 다룰 **가상 메모리(Virtual Memory)** 는, 메인 메모리에 원하는 데이터가 존재하지 않을 수도 있다는 상황까지 포함하는 개념이다. 즉, 가상 메모리는 실제 메모리에 전부 올리지 않고도 프로그램을 실행할 수 있게 해주는 확장된 메모리 관리 기법이다.

---
## **Motivation of Virtual Memory**

프로그램이 실행되는 매 순간을 살펴보면, 실제로 그들이 사용하는 코드나 데이터 전체가 항상 필요한 것은 아니다. 실행 상황에 따라 사용되는 코드가 달라지고, 전체 코드가 모두 사용되는 경우는 드물다. 예를 들어, 오류 처리 코드(error code)나 특이한 경로의 루틴(unusual routines) 등은 프로그램 실행 중에 한 번도 사용되지 않을 수 있다.

페이징을 통해 외부 단편화를 줄일 수는 있었지만, 페이지 단위로 메모리에 적재할 때 굳이 사용되지도 않을 데이터를 모두 불러올 필요는 없지 않을까?라는 의문이 생겼고, 결국 필요한 부분만 메모리에 가져오기 위한 방법이 고민되었다.

그 해결책이 바로 **프로그램을 부분적으로 나누어 필요한 부분만 가져오자!** 는 접근이다. 이렇게 하면 프로그램은 더 이상 물리적 메모리 크기에 제약을 받지 않게 된다. 예를 들어, 8GB짜리 게임이 있다고 해도, 실제 실행 시 필요한 부분만 메모리에 불러온다면, 메인 메모리 크기가 4GB여도 실행이 가능해지는 것이다.

또한 각 프로그램이 실행 중에 사용하는 메모리의 양이 줄어들게 되므로, 전체적으로 더 많은 프로세스를 동시에 메모리에 적재할 수 있게 된다. 이로 인해 **CPU utilization**과 **throughput**도 자연스럽게 향상된다.

뿐만 아니라, 메모리에 실제로 데이터를 로드하거나 교체(swap)하는 횟수가 줄어들게 되므로, 불필요한 I/O가 감소하고 결과적으로 프로그램의 실행 속도도 빨라진다. 이러한 개념과 기법이 바로 **가상 메모리(Virtual Memory)** 이다.

---
## **Virtual Memory**

**Logical 메모리와 Physical 메모리를 분리**하면, **논리 주소 공간(logical address space)** 은 실제 물리 주소 공간(physical address space)보다 훨씬 커질 수 있다. 그 이유는, 어차피 실행 시점에 **실제로 필요한 데이터만 메모리에 가져오면 되기 때문**이다.

즉, 모든 데이터를 한꺼번에 물리 메모리에 올릴 필요가 없으므로, 전체 논리 주소 공간이 물리 메모리의 크기를 넘어도 문제가 되지 않는다. 이러한 분리를 통해 **프로세스는 매우 큰 주소 공간을 할당받는 것처럼 동작할 수 있으며**, 이는 가상 메모리 덕분에 가능하다. 결과적으로 주소 공간의 제약이 사라지고, 더 유연하고 효율적인 메모리 관리가 가능해진다.

**Virtual address space**는 "프로세스가 메모리에 어떻게 저장되는가"에 대한 **논리적인 관점(logical view)** 을 제공하며, 이는 어떤 프로세스든지 동일한 방식으로 사용된다.

> [!note]
> - 가상 주소 공간은 보통 **주소 0부터 시작하여**, **연속적인 주소들**로 끝까지 이어지는 형식을 갖는다.
>     
> - 반면에 실제 물리 메모리는 **페이지 프레임(page frame)** 단위로 나뉘어 저장된다.
>     
> - 따라서 **MMU(Memory Management Unit)**는 논리 주소(logical address)를 물리 주소(physical address)로 적절히 **매핑(mapping)**해 주어야 한다.

Virtual 메모리는 Demand paging, Demand Segmentation으로 구현할 수 있다.

![](../images/Pasted%20image%2020250531180248.png)

현재 사용되는 데이터만 올라간다. 유효하긴 하지만 현재 사용되지 않는 애들은 메모리에 있을 수도 있고, 디스크에 있을 수도 있다. 